<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:include="fragments/head :: head(~{::title})">
    <meta charset="UTF-8">
    <title>Список</title>
</head>

<body>

<!--<header th:replace="fragments/header :: header(home='true', login='false', services='false', contact='false',-->
<header th:replace="fragments/header">&nbsp;
</header>

<!--<hr/>-->

<main class="container my-2 main" role="main">

    <nav class="navbar navbar-expand-lg navbar-light bg-light rounded">
        <div class="collapse navbar-collapse justify-content-md-center">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">Главная</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" tabindex="-1" aria-disabled="true" href="#">Книги</a>
                </li>
            </ul>
        </div>
    </nav>

    <h3 align="center">Список</h3>

    <!--   Search Bar   -->
    <nav class="navbar navbar-light bg-light">
        <a class="padding5px nav-link disable" th:href="@{/books/}"
           data-toggle="tooltip" data-placement="top" title="Сброс">
            <img th:src="@{/resources/open-iconic/png/reload-3x.png}"></a>

        <a type="button" class="btn btn-danger btn-sm px-3" th:href="@{/books/deleteAll}"
           data-toggle="tooltip" data-placement="top" title="Удалить всё">
            <i class="fas fa-times">X</i>
        </a>

        <a class="padding5px btn btn-sm btn-secondary" th:href="@{/books/import}"
           role="button"
           data-toggle="tooltip" data-placement="top" title="Импортировать данные">
    <span class="fa fa-search form-control-feedback"><img th:src="@{/resources/octicons/database-24.svg}">
    </span>Импорт</a>

        <form class="form-inline my-2 my-lg-0" method="get" th:action="@{/books/search}">
            <input type="hidden" th:value="${sortField}" name="sortField">
            <input type="hidden" th:value="${sortDir}" name="sortDir">
            <input type="hidden" th:value="${reverseSortDir}" name="reverseSortDir">
            <input type="hidden" th:value="${pageSize}" name="pageSize">

            <div class="form-inline">
                <span class="navbar-text">использовать регулярные выраж.</span>
                <input class="form-check-input" type="checkbox" id="defaultCheck1" name="regex">
                <div class="form-group has-search">
          <span class="fa fa-search form-control-feedback">
            <img th:src="@{/resources/octicons/search-24.svg}">
          </span>
                    <input class="form-control mr-sm-2" type="text" required placeholder="Search" name="keyword"
                           aria-label="Search">
                </div>

                <button class="btn btn-sm btn-outline-success my-2 my-sm-0" type="submit">Искать во всех полях</button>
            </div>
        </form>
    </nav>

    <!--   Table Start   -->
    <table border="1" cellpadding="5" class="table table-hover table-sm table-striped">
        <thead class="thead-dark">
        <tr>
            <th scope="row">
                <input type="checkbox" id="idSelectAll" class="select-all checkbox " name="select-all"/>

                <a th:href="@{'/books/page/' + ${currentPage} + '?sortField=id&sortDir=' + ${reverseSortDir} + '&pageSize=' + ${pageSize}}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_active3.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по ID's"
                         th:if="${#strings.equalsIgnoreCase(sortField, 'ID')}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_invert.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по ID's"
                         th:if="${!#strings.equalsIgnoreCase(sortField, 'ID')}">
                    # ID</a>
            </th>
            <th scope="col">
                <a th:href="@{'/books/page/' + ${currentPage} + '?sortField=author&sortDir=' + ${reverseSortDir} + '&pageSize=' + ${pageSize}}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_active3.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по Авторам"
                         th:if="${#strings.equalsIgnoreCase(sortField, 'author')}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_invert.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по Авторам"
                         th:if="${!#strings.equalsIgnoreCase(sortField, 'author')}">
                    Автор</a>
            </th>
            <th scope="col"><a
                    th:href="@{'/books/page/' + ${currentPage} + '?sortField=title&sortDir=' + ${reverseSortDir} + '&pageSize=' + ${pageSize}}">
                <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_active3.png}"
                     data-toggle="tooltip" data-placement="top" title="Сортировать по Названиям"
                     th:if="${#strings.equalsIgnoreCase(sortField, 'title')}">
                <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_invert.png}"
                     data-toggle="tooltip" data-placement="top" title="Сортировать по Названиям"
                     th:if="${!#strings.equalsIgnoreCase(sortField, 'title')}">
                Название</a>
            </th>
            <th scope="col">
                <a th:href="@{'/books/page/' + ${currentPage} + '?sortField=size&sortDir=' + ${reverseSortDir} + '&pageSize=' + ${pageSize}}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_active3.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по Страницам"
                         th:if="${#strings.equalsIgnoreCase(sortField, 'size')}">
                    <img th:src="@{/resources/open-iconic/png/sort-ascending-2x_invert.png}"
                         data-toggle="tooltip" data-placement="top" title="Сортировать по Страницам"
                         th:if="${!#strings.equalsIgnoreCase(sortField, 'size')}">
                    Страниц</a>
            </th>
            <th scope="col">Опции</th>
        </tr>
        </thead>

        <tbody>
        <!-- Filter Form -->
        <tr>
            <form class="form-inline" th:action="@{/books/filter}" method="get">
                <input type="hidden" th:value="${sortField}" name="sortField">
                <input type="hidden" th:value="${sortDir}" name="sortDir">
                <input type="hidden" th:value="${reverseSortDir}" name="reverseSortDir">
                <input type="hidden" th:value="${pageSize}" name="pageSize">

                <th scope="row"><input class="form-control" type="text" name="idKey" placeholder="id"></th>
                <td><input class="form-control" type="text" name="authorKey" placeholder="автор"></td>
                <td><input class="form-control" type="text" name="titleKey" placeholder="название"></td>
                <td><input class="form-control" type="text" name="sizeKey" placeholder="страниц"></td>

                <td>
                    <div class="form-inline">
                        <div class="d-inline">regex .</div>
                        <input class="form-check-input d-inline" type="checkbox" name="regex"
                               data-toggle="tooltip" data-placement="top" title="Использовать регулярные выражения">
                        <button type="submit" class="btn btn-sm btn-outline-secondary d-inline">Фильтровать
                        </button>
                    </div>
                </td>
            </form>
        </tr>

        <!-- Load Data -->
        <tr th:each="item : ${list}">
            <th scope="row">
                <input th:id="${item.id}" th:value="${item.id}" class="cl_checkbox select-item checkbox" type="checkbox"
                       name="checkedid select-item"/>
                <label th:text="${item.id}"/>
            </th>

            <td th:text="${item.author}"></td>
            <td th:text="${item.title}"></td>
            <td th:text="${item.size}"></td>

            <td><a th:href="@{/books/update/{id}(id=${item.id})}" class="btn btn-primary btn-sm">Обновить</a>
                <a th:href="@{/books/delete/{id}(id=${item.id})}" class="btn btn-danger btn-sm">
                    <img th:src="@{/resources/octicons/trash-16.svg}"></a>
            </td>

        </tr>

        <!-- Del Button and Add Form-->
        <tr>
            <th scope="row">
                <button onclick="btnUseCheckedBoxesAndDelAndRedirect()" class="btn btn-sm btn-warning btn-sm mb-3"
                        data-toggle="tooltip" data-placement="top" title="Удалить Выбранное в checkbox">
                    <!--                    <img th:src="@{/resources/octicons/trash-24.svg}">Удалить-->
                    <img th:src="@{/resources/open-iconic/png/trash-2x.png}">Удалить
                </button>
            </th>

            <form class="form-inline" th:action="@{/books/saveForm}" method="post" modelAttribute="form"
                  th:object="${form}">
                <td>
                    <div class="form-group input-group"
                         th:classappend="${!#fields.hasErrors('author')} ? class : was-validated">
                        <input th:field="*{author}" class="form-control" placeholder="автор" type="text"
                               th:classappend="${!#fields.hasErrors('author')} ? class : invalid"/>
                        <p th:if="${#fields.hasErrors('author')}" th:errors="*{author}" th:errorclass="error"
                           class="invalid-feedback">
                            Incorrect author</p>
                    </div>
                </td>

                <td>
                    <div class="form-group input-group"
                         th:classappend="${!#fields.hasErrors('title')} ? class : was-validated">
                        <input th:field="*{title}" class="form-control" placeholder="название" type="text"
                               th:classappend="${!#fields.hasErrors('title')} ? class : invalid"/>
                        <p th:if="${#fields.hasErrors('title')}" th:errors="*{title}" th:errorclass="error"
                           class="invalid-feedback">
                            Incorrect title</p>
                    </div>
                </td>

                <td>
                    <div class="form-group input-group"
                         th:classappend="${!#fields.hasErrors('size')} ? class : was-validated">
                        <input th:field="*{size}" class="form-control" placeholder="страниц" type="number"/>
                        <!-- <p th:if="${#fields.hasErrors('size')}" th:errors="*{size}" th:errorclass="error" class="invalid-feedback">
                          Incorrect size</p> -->
                    </div>
                </td>

                <td>
                    <button type="submit" value="Добавить" class="btn btn-sm bg-info btn-outline-secondary">
                        <img th:src="@{/resources/octicons/checklist-24.svg}"> Добавить
                    </button>
                </td>
            </form>
        </tr>

        </tbody>
    </table>

    <!-- >>> PAGINATION  -->
    <nav class="navbar navbar-light bg-light fixed-table-pagination">
        <div class="float-left pagination-detail">
            <span class="pagination-info">Всего записей: [[${totalItems}]]</span>

            <div class="btn-group dropup">
                <button class="btn btn-secondary btn-sm" type="button">Записей на страницу</button>
                <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item"
                       th:href="@{'/books/page/' + '1' + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + '5'}">5</a>
                    <a class="dropdown-item"
                       th:href="@{'/books/page/' + '1' + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + '10'}">10</a>
                    <a class="dropdown-item"
                       th:href="@{'/books/page/' + '1' + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + '15'}">15</a>
                    <a class="dropdown-item"
                       th:href="@{'/books/page/' + '1' + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + '25'}">25</a>
                </div>
            </div>

        </div>

        <div class="float-right pagination">
            <ul class="pagination" id="ulPageId">

                <li class="page-item page-pre padding5px">
                    <a class="page-link" aria-label="to page‹" th:if="${currentPage > 3}"
                       th:href="@{'/books/page/' + ${1}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + ${pageSize}}">Первая</a>
                    <span th:unless="${currentPage > 5}"></span>
                </li>

                <!-- Prev -->
                <li class="page-item page-pre">
                    <a class="page-link" aria-label="to page‹" th:if="${currentPage > 1}"
                       th:href="@{'/books/page/' + ${currentPage - 1}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + ${pageSize}}">‹</a>
                    <span th:unless="${currentPage > 1}"></span>
                </li>

                <!-- Pages Links -->
                <span th:each="i: ${#numbers.sequence(1, totalPages)}" th:if="${totalPages > 2}">
                      <li th:if="${currentPage != i}" class="page-item">
                        <a class="page-link"
                           th:href="@{'/books/page/' + ${i}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + ${pageSize}}">[[${i}]]</a>
                      </li>
                      <li th:unless="${currentPage != i}" class="page-item active">
                        <a class="page-link">[[${i}]]</a>
                      </li>  &nbsp; &nbsp;
                    </span>

                <!-- Next -->
                <li class="page-item page-next">
                    <a class="page-link" aria-label="to page›" th:if="${currentPage < totalPages}"
                       th:href="@{'/books/page/' + ${currentPage + 1}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + ${pageSize}}">›</a>
                    <span th:unless="${currentPage < totalPages}"></span>
                </li>

                <li class="page-item page-next">
                    <a class="page-link" aria-label="to page›" th:if="${currentPage > 3}"
                       th:href="@{'/books/page/' + ${totalPages}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&pageSize=' + ${pageSize}}">последняя</a>
                    <span th:unless="${currentPage < totalPages}"></span>
                </li>

            </ul> <!-- <ul class="pagination" id="ulPageId"> -->
        </div><!--     <div class="float-right pagination"> -->
    </nav>
    <!--  PAGINATION <<< -->

    <br/>
    <br/>
    <br/>
</main> <!-- <div class="container my-2"> -->

<hr/>
<footer th:replace="~{fragments/footer :: footer}"></footer>
<div th:replace="~{fragments/footer :: scripts}"></div>
<script th:src="@{/resources/js/books_list.js}"></script>

</body>
</html>
